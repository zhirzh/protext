module.exports=function(t){function e(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var n={};return e.m=t,e.c=n,e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:r})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=3)}([function(t,e){t.exports=require("path")},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}function a(t){h.default.existsSync(t)||h.default.mkdirSync(t);var e=g.default.resolve(t,"protext");h.default.existsSync(e)||h.default.mkdirSync(e),h.default.readdirSync(e).forEach(function(t){return h.default.unlinkSync(g.default.resolve(e,t))})}function i(){var t=[].concat(o("1234567890"),o("abcdefghijklmnopqrstuvwxyz"),o("ABCDEFGHIJKLMNOPQRSTUVWXYZ"));return{source:t.slice(),target:t.slice()}}function s(t,e){return e.map(function(e){return'\n      @font-face {\n      src: url("'+t+"/protext/"+e+'.ttf");\n      font-family: "protext_'+e+'";\n    }\n  '}).join("")}function u(t){return t.map(function(t){return'"protext_'+t+'"'}).join(", ")}function c(t,e,n){return"\n    <style>\n      "+s(t,e)+"\n\n      .protext {\n        font-family: "+u(e)+', "'+n+'";\n      }\n    </style>\n  '}function l(){return d.default.randomBytes(16).toString("hex")}Object.defineProperty(e,"__esModule",{value:!0});var f=n(6),d=r(f),p=n(2),h=r(p),y=n(0),g=r(y);e.default={cleanDestination:a,getDefaultCharsets:i,generateStyleTag:c,randomString:l}},function(t,e){t.exports=require("fs")},function(t,e,n){n(4),t.exports=n(5)},function(t,e){t.exports=require("babel-polyfill")},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){var n=[],r=!0,o=!1,a=void 0;try{for(var i,s=t[Symbol.iterator]();!(r=(i=s.next()).done)&&(n.push(i.value),!e||n.length!==e);r=!0);}catch(t){o=!0,a=t}finally{try{!r&&s.return&&s.return()}finally{if(o)throw a}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),s=n(0),u=r(s),c=n(1),l=r(c),f=n(7),d=r(f),p=n(9),h=r(p),y=n(11),g=function(){function t(e){o(this,t);var n=(0,d.default)(e);if(null!==n)throw n;return this.unpackOptions(e),l.default.cleanDestination(this.destination),this.mapper=this.generateMapper(),this.targetFonts=this.generateTargetFonts(),this.targetFontFilenames=this.writeTargetFont(),new h.default({destination:this.destination,fontFamily:this.fontFamily,mapper:this.mapper,targetFontFilenames:this.targetFontFilenames})}return i(t,[{key:"generateMapper",value:function(){var t=this,e=new Map;return this.sourceCharset.forEach(function(n){var r=Math.floor(t.targetCharset.length*Math.random()),o=t.targetCharset.splice(r,1)[0];e.set(n,o)}),e}},{key:"generateTargetFonts",value:function(){for(var t=this,e=new y.Glyph({name:".notdef",unicode:0,advanceWidth:650,path:new y.Path}),n=[],r=0;r<this.targetFontFileCount;r+=1)n.push([e]);return Array.from(this.mapper.entries()).forEach(function(e){var r=a(e,2),o=r[0],i=r[1],s=t.sourceFont.charToGlyph(o),u=new y.Glyph(t.sourceFont.charToGlyph(i));u.path=s.path,u.advanceWidth=s.advanceWidth;var c=Math.floor(Math.random()*n.length);n[c].push(u)}),n.filter(function(t){return t.length>1}).map(function(e){var n=new y.Font({familyName:t.sourceFont.familyName,styleName:t.sourceFont.styleName,unitsPerEm:t.sourceFont.unitsPerEm,ascender:t.sourceFont.ascender,descender:t.sourceFont.descender,glyphs:e});return n.filename=l.default.randomString(),n})}},{key:"unpackOptions",value:function(t){this.destination=t.destination;var e=t.charsets||l.default.getDefaultCharsets();this.sourceCharset=e.source,this.targetCharset=e.target,this.sourceFont=y.loadSync(t.font),this.sourceFont.familyName=this.sourceFont.names.fontFamily.en||l.default.randomString(),this.sourceFont.styleName=this.sourceFont.names.fontSubfamily.en||l.default.randomString(),this.fontFamily=t.fontFamily||this.sourceFont.names.fontFamily.en||l.default.randomString(),this.targetFontFileCount=t.count||1}},{key:"writeTargetFont",value:function(){var t=u.default.resolve(this.destination,"protext");return this.targetFonts.forEach(function(e){var n=u.default.resolve(t,e.filename+".ttf");e.download(n)}),this.targetFonts.map(function(t){return t.filename})}}]),t}();e.default=g},function(t,e){t.exports=require("crypto")},function(t,e,n){"use strict";function r(t){switch(!0){case void 0===t:case null===t:return a.default["options-not-defined"];case t.constructor!==Object:return a.default["options-not-object"];case"charsets"in t:switch(!0){case void 0===t.charsets:case null===t.charsets:return a.default["charsets-not-defined"];case t.charsets.constructor!==Object:return a.default["charsets-not-object"];case void 0===t.charsets.source:case null===t.charsets.source:return a.default["source-not-defined"];case t.charsets.source.constructor!==Array:return a.default["source-not-array"];case void 0===t.charsets.target:case null===t.charsets.target:return a.default["target-not-defined"];case t.charsets.target.constructor!==Array:return a.default["target-not-array"];case t.charsets.target.length<t.charsets.source.length:return a.default["target-smaller-than-source"];default:return null}case"count"in t:switch(!0){case void 0===t.count:case null===t.count:return a.default["count-not-defined"];case t.count.constructor!==Number:return a.default["count-not-object"];default:return null}case void 0===t.destination:case null===t.destination:return a.default["destination-not-defined"];case t.destination.constructor!==String:return a.default["destination-not-string"];case void 0===t.font:case null===t.font:return a.default["font-not-defined"];case t.font.constructor!==String:return a.default["font-not-string"];case"fontFamily"in t:switch(!0){case void 0===t.fontFamily:case null===t.fontFamily:return a.default["fontFamily-not-defined"];case t.fontFamily.constructor!==String:return a.default["fontFamily-not-string"];default:return null}default:return null}}Object.defineProperty(e,"__esModule",{value:!0});var o=n(8),a=function(t){return t&&t.__esModule?t:{default:t}}(o);e.default=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r={"options-not-defined":new Error("`options MUST be defined`"),"options-not-object":new Error("`options` MUST be an object"),"charsets-not-defined":new Error("`options.charsets MUST be defined`"),"charsets-not-object":new Error("`options.charsets` MUST be an object"),"count-not-defined":new Error("`options.count MUST be defined`"),"count-not-object":new Error("`options.count` MUST be a number"),"source-not-array":new Error("`options.charsets.source` MUST be an array"),"source-not-defined":new Error("`options.charsets.source MUST be defined`"),"target-not-array":new Error("`options.charsets.target` MUST be an array"),"target-not-defined":new Error("`options.charsets.target MUST be defined`"),"target-smaller-than-source":new Error("`options.charsets.target` MUST be larger than or equal to `options.charsets.source`"),"destination-not-defined":new Error("`options.destination MUST be defined`"),"destination-not-string":new Error("`options.destination` MUST be a string"),"font-not-defined":new Error("`options.font MUST be defined`"),"font-not-string":new Error("`options.font` MUST be a string"),"fontFamily-not-defined":new Error("`options.fontFamily MUST be defined`"),"fontFamily-not-string":new Error("`options.fontFamily` MUST be a string")};e.default=r},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=n(2),s=r(i),u=n(0),c=r(u),l=n(1),f=r(l),d=n(10),p=function(){function t(e){var n=this;o(this,t),this.sourceTextReplacer=function(t,e){return'<span class="protext">'+n.encodeText(e)+"</span>"},this.encodeHtmlFile=function(t,e){e=e.replace(/\.tmpl$/g,"");var r=s.default.readFileSync(t,"utf8"),o=n.generateStyleTag(e);r=r.replace(n.protextStyleRegexp,o),r=r.replace(n.sourceTextRegexp,n.sourceTextReplacer),s.default.writeFileSync(e,r)},this.encodeHtmlStream=function(t,e){if(e=e.replace(/\.tmpl$/g,""),t===e)throw new Error("`entry` and `output` paths MUST be different");var r=s.default.createReadStream(t),o=s.default.createWriteStream(e),a=n.generateStyleTag(e);r.pipe(d(n.protextStyleRegexp,a)).pipe(d(n.sourceTextRegexp,n.sourceTextReplacer)).pipe(o)},this.encodeText=function(t){return t.split("").map(function(t){return n.mapper.get(t)||t}).join("")},this.unpackOptions(e),this.protextStyleRegexp=new RegExp("{{protext}}","g"),this.sourceTextRegexp=new RegExp("{{#protext}}([\\s\\S]*?){{/protext}}","g")}return a(t,[{key:"unpackOptions",value:function(t){this.destination=t.destination,this.fontFamily=t.fontFamily,this.mapper=t.mapper,this.targetFontFilenames=t.targetFontFilenames}},{key:"generateStyleTag",value:function(t){var e=c.default.relative(c.default.dirname(t),this.destination);return f.default.generateStyleTag(e||".",this.targetFontFilenames,this.fontFamily)}}]),t}();e.default=p},function(t,e){t.exports=require("replacestream")},function(t,e){t.exports=require("opentype.js")}]);